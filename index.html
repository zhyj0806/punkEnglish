<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<link rel="stylesheet/less" type="text/css" href="css/less.less" />
		<script src="http://libs.baidu.com/zepto/0.8/zepto.min.js"></script>
		<script src="js/less.min.js"></script>
		<script src="js/rem.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<header>
			<div class="back"><i class="icon iconfont"></i></div>
			<div class="share"><i class="icon iconfont"></i></div>
			<time>2016-06-03</time>
		</header>
		<figure>
			<figcaption>当神夏遇到了日漫</figcaption>
			<div class="pic">
				<img src="images/img.png" alt="" />
				<div id="music">
					<div class="details">
						<span class="play"></span>
						<div class="progress"><div class="nowProgress"><div class="progressBg"><span id="span"></span></div></div></div>
						<div class="reader">欧阳丽丽</div>		
						<div class="pic">
							<img src="images/photo1.png">
						</div>
								<audio id="myaudio" autoplay src="2.mp3" controls></audio>
					</div>
				</div>
			</div>
			<div class="text">
				<p>Twinkle Little Star! Get the interactiv App!: itunes.butis
apple.comle How the main content of the briefing is st
content of headings. </p>
				<p>Twinkle Little Star! Get the interactiv App!: itunes.butis
apple.comle How the main content of.</p>
			</div>
		</figure>
		<section>
			<header>
				<a>更多>></a>
				达人榜
				
			</header>
			<div class="master">
				<div class="masterMian clearfix">
					<div class="photo"><img src="images/photo.png" alt="" /></div>
					<div class="names">
						<div class="">Lilly Lilly</div>
						<time>2016-5-29 23：23</time>
					</div>
					<div class="tool">
						<span class="qipao">10'</span>
						<span class="reply"><i class="icon iconfont"></i>19</span>
						<span class=""><i class="icon iconfont on"></i>205</span>
					</div>
					<div class="tip">
						<ul>
							<li>回复文字</li>
							<li>回复语音</li>
						</ul>
					</div>
				</div>
					<p><span class="responder">Mary :</span>Twinkle Little Star! Get the interactiv App!: itunes.</p>
					
					<p><span class="responder">Lilly Lilly 回复LiLei：</span>Star! Get the interactiv App!: itunes.
</p>
			</div>
			<div class="master">
				<div class="masterMian clearfix">
					<div class="photo"><img src="images/photo.png" alt="" /></div>
					<div class="names">
						<div class="">Lilly Lilly</div>
						<time>2016-5-29 23：23</time>
					</div>
					<div class="tool">
						<span class="qipao">10'</span>
						<span class="reply"><i class="icon iconfont"></i>19</span>
						<span class=""><i class="icon iconfont on"></i>205</span>
					</div>
					<div class="tip">
						<ul>
							<li>回复文字</li>
							<li>回复语音</li>
						</ul>
					</div>
				</div>
					<p><span class="responder">Mary :</span>Twinkle Little Star! Get the interactiv App!: itunes.</p>
					
					<p><span class="responder">Lilly Lilly 回复LiLei：</span>Star! Get the interactiv App!: itunes.
</p>
			</div>
			<div class="master">
				<div class="masterMian clearfix">
					<div class="photo"><img src="images/photo.png" alt="" /></div>
					<div class="names">
						<div class="">Lilly Lilly</div>
						<time>2016-5-29 23：23</time>
					</div>
					<div class="tool">
						<span class="qipao">10'</span>
						<span class="reply"><i class="icon iconfont"></i>19</span>
						<span class=""><i class="icon iconfont on"></i>205</span>
					</div>
					<div class="tip">
						<ul>
							<li>回复文字</li>
							<li>回复语音</li>
						</ul>
					</div>
				</div>
					<p><span class="responder">Mary :</span>Twinkle Little Star! Get the interactiv App!: itunes.</p>
					
					<p><span class="responder">Lilly Lilly 回复LiLei：</span>Star! Get the interactiv App!: itunes.
</p>
			</div>
			<div class="master">
				<div class="masterMian clearfix">
					<div class="photo"><img src="images/photo.png" alt="" /></div>
					<div class="names">
						<div class="">Lilly Lilly</div>
						<time>2016-5-29 23：23</time>
					</div>
					<div class="tool">
						<span class="qipao">10'</span>
						<span class="reply"><i class="icon iconfont"></i>19</span>
						<span class=""><i class="icon iconfont on"></i>205</span>
					</div>
					<div class="tip">
						<ul>
							<li>回复文字</li>
							<li>回复语音</li>
						</ul>
					</div>
				</div>
					<p><span class="responder">Mary :</span>Twinkle Little Star! Get the interactiv App!: itunes.</p>
					
					<p><span class="responder">Lilly Lilly 回复LiLei：</span>Star! Get the interactiv App!: itunes.
</p>
			</div>
		</section>
		<div class="opcity"></div>
		<div class="voice"><i class="icon iconfont"></i></div>
		<div class="words"><i class="icon iconfont"></i></div>
		<div class="recording">
			<div class="reRecorded">重新录音</div>
			<div class="deg">
				<div class="hold hold1">
				<div class="pie pie1"></div>
				</div>
				<div class="hold hold2">
				<div class="pie pie2"></div>
				</div>
				<div class="bg"> </div>
				
				<div class="time"><i class="icon iconfont"></i></div>
			</div>
			<div class="send">发送录音</div>
		</div>
		<div class="replyText">
			<input type="" name="" class="" value="" /><span>发 送</span>
		</div>
<script type="text/javascript">
	window.onload=function(){
			function g(id){return document.getElementById(id)}
			var myAudio=document.getElementById('myaudio');
			var AudioLength=myAudio.duration;//总长度
			var curre=0;
			var isplay = true;
			var deg = 0;
			var str=['1.mp3',
			'2.mp3',
			'3.mp3',
			'4.mp3'];
			reset();
			$('.play').click(function(){
				if(myAudio.paused){
					myAudio.play();
					isplay = true;
					$(this).css('backgroundPosition','center 0');
				}else{
					myAudio.pause();
					isplay = false;
					$(this).css('background','url(images/suspend.png) no-repeat center/cover');
				}
			 
			})
			
			var next = function (){
				console.log("next.click")
				var curreAudio=$('#myaudio').attr('src');
				for(var i=0;i<str.length;i++){
					if(str[i]==curreAudio){
						$('#myaudio').attr('src',str[i + 1]);
						$('.play').css('backgroundPosition','center 0');
						isplay = true;
						reset();
						return false;
					}
				}
			}
			
			var prev = function(){
				var curreAudio=$('#myaudio').attr('src');
				for(var i=str.length;i>=0;i--){
					if(str[i]==curreAudio){
						$('#myaudio').attr('src',str[i - 1]);
						$('.play').css('backgroundPosition','center 0');
						isplay = true;
						reset();
						return false;
					}
				}
			}
			
			$('.nextBTN').click(next);
			$('.prevBtn').click(prev);
			
			//当前播放时间
			function nowProgress(curre){
				var newCurrentTime=curre;
				var spanLeft = ($('.progress').width()*newCurrentTime/AudioLength-8) + "px";
				$('.nowProgress').width(newCurrentTime/AudioLength*100+"%");
				$('#span').css('left',spanLeft)
				
			}
			
			
			function reset(){
				deg = 0;
				curre=0;
				nowProgress(curre);
				console.log(myAudio);
				getDuration();
			}
			
			function getDuration(){
				AudioLength=myAudio.duration;
				setTimeout(function(){
					if(AudioLength != AudioLength){
						getDuration();
					}
				}, 7);
			}
			
			/***********************************
			 * 鼠标 & 触摸事件
			 */
			var startX,offsetX,startTime;
			var isDraging=false;
			// 鼠标
			$("#span").bind('mousedown', function(e){
				var e=e||window.event;
				isDraging=true;	
			});
			$(document).bind('mousemove', function(e){
				var e=e||window.event;
				if(isDraging===true){
					draging(e.pageX);
				}
			});
			$(document).bind('mouseup', function(){
				isDraging=false;
			});
//			触摸
			$("#span").bind('touchstart',function(e){
				isDraging = true;
				startTime=new Date()*1;//时间戳
			})
			$("#span").bind('touchmove',function(e){
				e.preventDefault();
				if(isDraging){
					draging(e.touches[0].pageX);
				}
				
			});
			$("#span").bind('touchend',function(e){
				isDraging = false;
			});
			$(".progress").bind("click",function(e){
				var e=e||window.event;
				draging(e.pageX);
			});
			function draging(currentX){
				var progressWidth = $('.progress').width();
					var offsetX = currentX - $('.progress').offset().left;
					offsetX=Math.min(progressWidth,Math.max(0,offsetX));
					curre=AudioLength*offsetX/progressWidth;
					nowProgress(curre);
					myAudio.currentTime = curre;
					console.log(offsetX);
			}
			/*************************************/
			
			
			function rotate(){
				deg += (isplay &&　!isDraging) ? 0.8 : 0;
				deg = deg >= 360 ? deg - 360 : deg;
				$('.details .pic img').css({
					'-webkit-transform':'rotate('+deg+'deg)',
					'-moz-transform':'rotate('+deg+'deg)',
					'-o-transform':'rotate('+deg+'deg)',
					'-ms-transform':'rotate('+deg+'deg)',
					'transform':'rotate('+deg+'deg)'
				
				});
				setTimeout(rotate, 50); 
			}
			rotate();
			myAudio.addEventListener("timeupdate",function(){
					//console.log(myAudio.currentTime >= AudioLength - 2)
				if(myAudio.currentTime >= AudioLength - 0.1){
					next();
					//TODO 判断是否加载下一页，并加载
				}
				nowProgress(myAudio.currentTime);
			});

		$('.reply').bind('touchstart',function(e){
			$('.opcity').show();
			$(this).parent().parent().find('.tip').show();	
		})

		$('.voice,.tip li:last-child').bind('touchstart',function(e){
			$('.opcity').show();
			$('.recording').show();
			$('.tip,.replyText,.voice,.words').hide();
		})	
		$('.words,.tip li:first-child').bind('touchstart',function(e){
			$('.opcity').show();
			$(".replyText").show();
			$('.tip,.recording,.voice,.words').hide();
		})
		$('.opcity').bind('touchstart',function(e){
			$('.voice,.words').show();
			$('.recording,.tip,.opcity,.replyText').hide();
		})
	}


i = 0;
j = 0;
count = 0;
MM = 4;
SS = 59;
MS = 9;
totle = (MM+1)*600;
d = 180*(MM+1);
MM = "0" + MM;
function showTime(){
	totle = totle - 1;
	if(totle==0){
		clearInterval(s);
		clearInterval(t1);
		clearInterval(t2);
		$(".pie2").css("-o-transform","rotate(" + d + "deg)");
		$(".pie2").css("-moz-transform","rotate(" + d + "deg)");
		$(".pie2").css("-webkit-transform","rotate(" + d + "deg)");
	}else{
		if(totle>0 && MS>0){
			MS = MS - 1;
			if(MS < 10){MS = "0" + MS};
		};
		if(MS==0 && SS>0){
			MS = 10;
			SS = SS - 1;
			if(SS < 10){SS = "0" + SS};
		};
		if(SS==0 && MM>0){
			SS = 60;
			MM = MM - 1;
			if(MM < 10){MM = "0" + MM};
		};
	};
	$(".time span").html(MM + ":" + SS + ":" + MS);
};
s = setInterval("showTime()",100);

function start1(){
	i = i + 0.6;
	count = count + 1;
	if(count==300){
		count = 0;
		clearInterval(t1);
		t2 = setInterval("start2()",100);
	};
	$(".pie1").css("-o-transform","rotate(" + i + "deg)");
	$(".pie1").css("-moz-transform","rotate(" + i + "deg)");
	$(".pie1").css("-webkit-transform","rotate(" + i + "deg)");
};
function start2(){
	j = j + 0.6;
	count = count + 1;
	if(count==300){
		count = 0;
		clearInterval(t2);
		t1 = setInterval("start1()",100);
	};
	$(".pie2").css("-o-transform","rotate(" + j + "deg)");
	$(".pie2").css("-moz-transform","rotate(" + j + "deg)");
	$(".pie2").css("-webkit-transform","rotate(" + j + "deg)");
};
t1 = setInterval("start1()",100);

</script>
			
	</body>
</html>
